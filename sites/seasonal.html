<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Seasonal Planting Calendar â€¢ Patch &amp; Pot (UK)</title>
  <meta name="description" content="UK seasonal planting calendar for small spaces with Scotland, Ireland, England and Wales variants: what to sow, plant and harvest, plus pest watch.">
  <link rel="stylesheet" href="style.css?v=pp-stable">

  <!-- Page-local hard guards so nothing dims this page -->
  <style>
    html,body,#siteHeader,main,footer{opacity:1!important;filter:none!important}
    /* Patch & Pot-colour matched controls */
    .wrap{max-width:1140px;margin:0 auto;padding:16px 20px}
    .pp-sub{color:var(--muted)}
    .pp-card{background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:1rem;margin:1rem 0}
    .pp-toolbar{display:grid;gap:.8rem 1rem;grid-template-columns:1fr auto;align-items:center;padding:.7rem .9rem;background:rgba(255,255,255,.05);border:1px solid var(--stroke);border-radius:12px}
    .pp-toolbar .left{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
    .pp-toolbar .right{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .pp-select,.pp-search{background:#0c100e;color:var(--ink);border:1px solid var(--stroke);border-radius:10px;padding:.55rem .7rem}
    .pp-help{color:var(--muted);margin:.55rem 0 0}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:12px;padding:.75rem 1rem;font-weight:700;border:0;background:linear-gradient(180deg,var(--green2),var(--green));color:#061007;white-space:nowrap}
    .btn[disabled]{opacity:.7;cursor:wait}
    .pp-pestwatch{background:#1b221f;border-left:4px solid var(--green2);border-radius:14px;padding:1rem;margin:1rem 0;border:1px solid var(--stroke)}
    .pp-pestwatch small,.pp-month-hint{color:var(--muted)}
    .pp-pestwatch ul{margin:.4rem 0 0;padding-left:1.1rem}
    .pp-list{list-style:none;padding:0;margin:0}
    .pp-list li{padding:.55rem .65rem;border:1px dashed var(--stroke);border-radius:10px;margin:.4rem 0;background:#0f1512}
    .pp-legend{display:flex;gap:18px;align-items:center;margin:.4rem 0 .8rem}
    .pp-legend .i{display:inline-flex;align-items:center;gap:.45rem;color:var(--inkdim)}
    .pp-calendar{display:grid;grid-template-columns:220px repeat(12,minmax(52px,1fr));gap:2px;border:1px solid var(--stroke);border-radius:16px;overflow:hidden;background:#0f1512}
    .pp-row{display:contents}
    .pp-head,.pp-cell{padding:.55rem .6rem;border:1px solid var(--stroke);font-size:.95rem;line-height:1.3}
    .pp-head{font-weight:700;background:#121815}
    .pp-crop{font-weight:700;background:#121815;display:flex;flex-direction:column;gap:2px;word-break:break-word}
    .pp-tags{font-size:.82rem;color:var(--muted)}
    .note-rotate{color:var(--muted);margin:.5rem 0 1rem}
    /* mobile: keep the PDF button in-frame */
    @media(max-width:700px){
      .pp-toolbar{grid-template-columns:1fr}
      .pp-toolbar .right{justify-content:stretch}
      .pp-toolbar .right .btn{width:100%;justify-content:center}
    }
    /* ensure page content is visible regardless of external styles */
    #maincontent, .pp-card, .pp-pestwatch, .pp-list, .pp-calendar { color: var(--ink) !important; }
  </style>
</head>
<body>

<header class="site-header" id="siteHeader">
  <div class="brand">
    <img src="img/patchandpot-logo.png" alt="Patch &amp; Pot logo" class="logo" onerror="this.style.display='none'">
    <span class="site-title">Patch &amp; Pot</span>
  </div>
  <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="primaryNav">
    <span class="menu-ico"><span></span><span></span><span></span></span>
  </button>
  <nav class="nav" id="primaryNav" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="growing.html">Growing</a>
    <a href="seasonal.html" aria-current="page">Seasonal</a>
    <a href="recipes.html">Recipes</a>
    <a href="wellbeing.html">Wellbeing</a>
    <a href="exercise.html">Exercise</a>
    <a href="guides.html">Guides</a>
    <a href="ideas.html">Ideas</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<main class="wrap" id="maincontent">
  <h1>Seasonal Planting Calendar (UK)</h1>
  <p class="pp-sub">Small-space sowing, planting &amp; harvesting with regional variants for <strong>Scotland</strong>, <strong>Ireland</strong>, <strong>England</strong> and <strong>Wales</strong>.</p>

  <section class="pp-card">
    <div class="pp-toolbar" role="group" aria-label="Region and filters">
      <div class="left">
        <label for="pp-region">Region:</label>
        <select id="pp-region" class="pp-select">
          <option value="scotland">Scotland</option>
          <option value="ireland">Ireland</option>
          <option value="england">England</option>
          <option value="wales">Wales</option>
        </select>
        <input id="pp-search" class="pp-search" type="search" placeholder="Search crops (e.g., carrot, basil)â€¦">
        <label for="pp-category" class="sr-only" style="position:absolute;left:-9999px">Category</label>
        <select id="pp-category" class="pp-select">
          <option value="all">All categories</option>
          <option value="leafy">Leafy</option>
          <option value="roots">Roots</option>
          <option value="legumes">Legumes</option>
          <option value="fruit">Fruiting veg</option>
          <option value="alliums">Alliums</option>
          <option value="herbs">Herbs</option>
          <option value="other">Other</option>
        </select>
        <label for="pp-month-only" style="display:inline-flex;align-items:center;gap:.45rem">
          <input type="checkbox" id="pp-month-only"> <span>Show activity this month only</span>
        </label>
      </div>
      <div class="right">
        <label for="pp-page" style="display:inline-flex;align-items:center;gap:.45rem">Page:
          <select id="pp-page" class="pp-select">
            <option value="portrait">Portrait A4</option>
            <option value="landscape">Landscape A4</option>
          </select>
        </label>
        <label style="display:inline-flex;align-items:center;gap:.45rem">
          <input type="checkbox" id="pp-include-info" checked> Include Basics &amp; Pest Watch
        </label>
        <button id="pp-make-pdf" class="btn" type="button">ðŸ“„ Download PDF</button>
      </div>
    </div>
    <p class="pp-help">Tip: pick a <strong>Region</strong>, type to <strong>search</strong>, choose a <strong>Category</strong>, or toggle <strong>This month only</strong> for a focused view.</p>
  </section>

  <section class="pp-pestwatch" id="pp-pestwatch" aria-labelledby="pestwatch-title">
    <h3 id="pestwatch-title">Pest Watch â€“ <span id="pp-month-name"></span> (<span id="pp-region-name"></span>)</h3>
    <small>Small spaces edition</small>
    <ul><li>Loadingâ€¦</li></ul>
  </section>

  <section class="pp-card" aria-labelledby="today-title">
    <h2 id="today-title">What Can I Plant Today?</h2>
    <p class="pp-month-hint" id="pp-month-hint"></p>
    <ul id="pp-today-list" class="pp-list"></ul>
  </section>

  <div class="pp-legend" aria-hidden="true">
    <span class="i">ðŸŒ± <em>Sow</em></span>
    <span class="i">ðŸª´ <em>Plant</em></span>
    <span class="i">ðŸ¥• <em>Harvest</em></span>
  </div>

  <p class="note-rotate">On a narrow phone, rotate to landscape to see all months.</p>

  <section aria-labelledby="calendar-title">
    <h2 id="calendar-title">Seasonal Planting Calendar</h2>
    <div class="pp-calendar" id="pp-calendar" role="table" aria-label="Seasonal planting calendar"></div>
    <div id="pp-error" class="pp-pestwatch" style="display:none;background:#331c1c;border-left-color:#9b2f2f">
      <strong>Missing file(s)</strong><div id="pp-error-msg"></div>
    </div>
  </section>
</main>

<footer role="contentinfo">
  <div class="footer-inner">
    <img src="img/patchandpot-icon.png" alt="" class="footer-pot" onerror="this.style.display='none'">
    <p>Â© 2025 Patch &amp; Pot | Created by Grant Cameron Anthony</p>
  </div>
</footer>

<!-- simple sitewide mobile menu -->
<script>
(function(){
  const header=document.getElementById('siteHeader');
  const toggle=header.querySelector('.menu-toggle');
  const nav=document.getElementById('primaryNav');
  function setOpen(on){
    header.classList.toggle('menu-open',on);
    toggle.classList.toggle('menu-open',on);
    toggle.setAttribute('aria-expanded',on?'true':'false');
  }
  toggle.addEventListener('click',()=>setOpen(!header.classList.contains('menu-open')));
  nav.addEventListener('click',e=>{ if(e.target.tagName==='A') setOpen(false); });
})();
</script>

<!-- Seasonal page app (safe, self-contained) -->
<script>
(function(){
  const MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const CUR_M=new Date().getMonth();
  const REGIONS=["scotland","ireland","england","wales"];
  const CATFILES=["roots","leafy","legumes","fruit","alliums","herbs","softfruit","other"];

  const DATA={};           // {region:{basics,pestwatch,crops[]}}
  const MISS=new Map();    // region -> Set(missing file)

  function cap(s){return s? s[0].toUpperCase()+s.slice(1):""}
  function setMonthHints(){
    document.getElementById('pp-month-name').textContent=MONTHS[CUR_M];
    document.getElementById('pp-month-hint').textContent=`Hereâ€™s what suits containers now in ${MONTHS[CUR_M]}.`;
  }
  function inferCategory(n){
    n=(n||"").toLowerCase();
    if(/(lettuce|spinach|chard|rocket|kale|cabbage|salad|leaf|pak|choi|bok|mizuna|mustard|endive|tat\s*soi)/.test(n))return"leafy";
    if(/(carrot|beet|beetroot|radish|turnip|root|swede|celeriac|salsify|fennel)/.test(n))return"roots";
    if(/(pea|bean|lentil|chickpea|edamame)/.test(n))return"legumes";
    if(/(tomato|pepper|chilli|aubergine|eggplant|courgette|cucumber|squash|pumpkin|melon|strawber|raspber|gooseber|currant|fig|apple|pear|plum|cherry|rhubarb|tomatillo)/.test(n))return"fruit";
    if(/(onion|garlic|leek|shallot|chive)/.test(n))return"alliums";
    if(/(parsley|coriander|basil|mint|thyme|sage|dill|oregano|marjoram|tarragon|rosemary|chervil|lovage|bay)/.test(n))return"herbs";
    return"other";
  }
  function getSel(){
    return {
      region: document.getElementById('pp-region').value,
      q: (document.getElementById('pp-search').value||"").toLowerCase().trim(),
      cat: document.getElementById('pp-category').value,
      thisMonth: document.getElementById('pp-month-only').checked,
      orient: document.getElementById('pp-page').value,
      includeInfo: document.getElementById('pp-include-info').checked
    };
  }
  function filterCrops(list, sel){
    return (list||[])
      .filter(c=>c && c.name)
      .filter(c=>{
        if(sel.q && !c.name.toLowerCase().includes(sel.q)) return false;
        const cat=c.category||inferCategory(c.name);
        if(sel.cat!=="all" && cat!==sel.cat) return false;
        if(sel.thisMonth){
          const s=(c.months?.sow||[]).includes(CUR_M);
          const p=(c.months?.plant||[]).includes(CUR_M);
          const h=(c.months?.harvest||[]).includes(CUR_M);
          if(!(s||p||h)) return false;
        }
        return true;
      });
  }
  function markCell(c,i){
    const s=(c.months?.sow||[]).includes(i);
    const p=(c.months?.plant||[]).includes(i);
    const h=(c.months?.harvest||[]).includes(i);
    return [s?"ðŸŒ±":"",p?"ðŸª´":"",h?"ðŸ¥•":""].join(" ").trim();
  }

  async function fetchJSON(url){
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw new Error(url);
    return r.json();
  }
  async function loadRegion(region){
    const missing=new Set();
    async function tryGet(path, fallback){
      try{ return await fetchJSON(path); }
      catch{ missing.add(path); return fallback; }
    }
    const basics= await tryGet(`data/regions/${region}/basics.json`, {});
    const pest  = await tryGet(`data/regions/${region}/pestwatch.json`, {});
    const parts = await Promise.all(CATFILES.map(f=>tryGet(`data/regions/${region}/${f}.json`, [])));
    DATA[region]={basics,pestwatch:pest,crops:parts.flat().filter(x=>x && x.name)};
    MISS.set(region, missing);
  }

  function renderPest(region){
    const t=document.querySelector('#pp-pestwatch ul');
    const titleRegion=document.getElementById('pp-region-name');
    titleRegion.textContent=cap(region);
    const items=(DATA[region].pestwatch[String(CUR_M)]?.items)||["No major alerts this month. Keep an eye on slugs after rain."];
    t.innerHTML=items.map(i=>`<li>${i}</li>`).join('');
  }
  function renderToday(region,sel){
    const ul=document.getElementById('pp-today-list');
    const items=[];
    filterCrops(DATA[region].crops,sel).forEach(c=>{
      const s=(c.months?.sow||[]).includes(CUR_M);
      const p=(c.months?.plant||[]).includes(CUR_M);
      const h=(c.months?.harvest||[]).includes(CUR_M);
      if(s||p||h){
        const tag=c.category||inferCategory(c.name);
        items.push(`<li><strong>${c.name}</strong> ${s?"ðŸŒ±":""}${p?" ðŸª´":""}${h?" ðŸ¥•":""} <span class="pp-tags">(${tag})</span></li>`);
      }
    });
    ul.innerHTML=items.length?items.join(''):`<li>No items match your filters for ${MONTHS[CUR_M]}.</li>`;
  }
  function renderCalendar(region,sel){
    const holder=document.getElementById('pp-calendar');
    const head=`<div class="pp-row"><div class="pp-head">Crop</div>${MONTHS.map(m=>`<div class="pp-head">${m}</div>`).join('')}</div>`;
    const rows=filterCrops(DATA[region].crops,sel).map(c=>{
      const tag=c.category||inferCategory(c.name);
      const cells=MONTHS.map((_,i)=>`<div class="pp-cell">${markCell(c,i)}</div>`).join('');
      return `<div class="pp-row"><div class="pp-cell pp-crop"><span>${c.name}</span><span class="pp-tags">(${tag})</span></div>${cells}</div>`;
    }).join('');
    holder.innerHTML=head+rows;
  }
  function renderAll(){
    const sel=getSel();
    localStorage.setItem('pp-region', sel.region);
    setMonthHints();
    renderPest(sel.region);
    renderToday(sel.region, sel);
    renderCalendar(sel.region, sel);

    // Missing files box
    const miss=[...(MISS.get(sel.region)||[])];
    const box=document.getElementById('pp-error');
    const msg=document.getElementById('pp-error-msg');
    if(miss.length){
      box.style.display='block';
      msg.innerHTML = miss.map(u=>`<div><code>${u}</code></div>`).join('');
    }else{ box.style.display='none'; msg.innerHTML=''; }
  }

  // Boot
  (async function(){
    document.getElementById('pp-region').value = localStorage.getItem('pp-region') || 'scotland';
    const initial=document.getElementById('pp-region').value;
    await Promise.all(REGIONS.map(r=>loadRegion(r).catch(()=>{})));
    renderAll();
    ['pp-region','pp-category','pp-month-only'].forEach(id=>{
      document.getElementById(id).addEventListener('change',renderAll);
    });
    document.getElementById('pp-search').addEventListener('input',renderAll);

    // PDF button wiring
    document.getElementById('pp-make-pdf').addEventListener('click', async ()=>{
      const btn=document.getElementById('pp-make-pdf');
      try{
        btn.disabled=true; btn.textContent='Buildingâ€¦';
        if(!window.PP_PDF || !window.PP_PDF.generate){ alert('PDF generator not found.'); return; }
        const sel=getSel();
        await window.PP_PDF.generate({
          region: sel.region,
          category: sel.cat,
          q: sel.q,
          orientation: sel.orient,
          includeInfo: sel.includeInfo
        });
      }catch(e){
        alert('Sorry, PDF generation failed.');
        console.error(e);
      }finally{
        btn.disabled=false; btn.textContent='ðŸ“„ Download PDF';
      }
    });
  })();
})();
</script>

<!-- jsPDF + autoTable (UMD) -->
<script src="assets/pdf/jspdf.umd.min.js" defer></script>
<script src="assets/pdf/jspdf.plugin.autotable.min.js" defer></script>

<!-- Our generator (exports window.PP_PDF) -->
<script src="assets/pdf/pdf-generator.js?v=pp-stable" defer></script>
</body>
</html>
