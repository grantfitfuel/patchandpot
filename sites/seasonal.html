<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Seasonal Planting Calendar • Patch & Pot (UK)</title>
  <meta name="description" content="UK seasonal planting calendar for small spaces with Scotland, Ireland, England and Wales variants: what to sow, plant and harvest, plus pest watch.">

  <!-- Bust cache by bumping v -->
  <link rel="stylesheet" href="style.css?v=46">

  <!-- Page-only tweaks (ensure pot is small + centred even if CSS cached) -->
  <style>
    footer{ border-top:1px solid #142116; margin-top:28px; background:#0a0f0c; text-align:center; padding:20px 0 }
    .footer-inner{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px }
    .footer-pot{ width:28px !important; height:28px !important; object-fit:contain !important; }
    footer p{ margin:0; font-size:.9rem; color:#9ab09f }

    /* Seasonal skin (kept minimal) */
    :root{ --pp-ink:#e6f0ea; --pp-muted:#a6b6af; --pp-panel:#161c19; --pp-panel-2:#1b221f; --pp-line:#2b332f; --pp-green:#35c26a; }
    .sub{ color:var(--pp-muted); margin:0 0 .8rem }
    .pp-card{ background:var(--pp-panel); border:1px solid var(--pp-line); border-radius:16px; padding:1rem; margin:1rem 0 }
    .pp-toolbar{ display:flex; flex-wrap:wrap; gap:.6rem 1rem; align-items:center; padding:.6rem .8rem; background:rgba(255,255,255,.02); border:1px solid var(--pp-line); border-radius:12px }
    .pp-select,.pp-search{ background:#0c100e; color:var(--pp-ink); border:1px solid var(--pp-line); border-radius:10px; padding:.5rem .65rem }
    .pp-help{ color:var(--pp-muted); margin:.5rem 0 0 }
    .pp-filters{ display:grid; gap:.6rem 1rem; grid-template-columns:1fr auto; align-items:center }
    .pp-filters .left{ display:flex; gap:.6rem; flex-wrap:wrap; align-items:center }
    .pp-filters .right{ display:flex; gap:.6rem; align-items:center }
    .pp-pestwatch{ background:var(--pp-panel-2); border-left:4px solid var(--pp-green); border-radius:14px; padding:1rem; margin:1rem 0; border:1px solid var(--pp-line) }
    .pp-pestwatch ul{ margin:.4rem 0 0; padding-left:1.1rem }
    .pp-month-hint{ color:var(--pp-muted); margin:.2rem 0 .6rem }
    .pp-list{ list-style:none; padding:0; margin:0 }
    .pp-list li{ padding:.55rem .65rem; border:1px dashed var(--pp-line); border-radius:10px; margin:.4rem 0; background:#0f1512 }
    .pp-calendar{ display:grid; grid-template-columns:220px repeat(12, minmax(52px,1fr)); gap:2px; border:1px solid var(--pp-line); border-radius:16px; overflow:hidden; background:#0f1512 }
    .pp-row{ display:contents }
    .pp-cell,.pp-head{ padding:.55rem .6rem; border:1px solid var(--pp-line); font-size:.95rem }
    .pp-head{ font-weight:700; background:#121815 }
    .pp-crop{ font-weight:700; background:#121815; white-space:nowrap }
    .pp-tags{ display:inline-block; font-size:.8rem; color:var(--pp-muted); margin-left:.4rem }
    @media (max-width:800px){ .pp-filters{ grid-template-columns:1fr } .pp-calendar{ grid-template-columns:160px repeat(12, minmax(42px,1fr)) } .pp-cell,.pp-head{ padding:.45rem } h1{ font-size:1.8rem } .sub{ font-size:1rem } }
  </style>
</head>
<body>

  <!-- Shared header: this div will be replaced by header.html -->
  <div data-include="partials/header.html"></div>

  <main class="wrap" id="maincontent">
    <h1>Seasonal Planting Calendar (UK)</h1>
    <p class="sub">Small-space sowing, planting &amp; harvesting with regional variants for <strong>Scotland</strong>, <strong>Ireland</strong>, <strong>England</strong> and <strong>Wales</strong>.</p>

    <section class="pp-card">
      <div class="pp-toolbar pp-filters" role="group" aria-label="Region and filters">
        <div class="left">
          <label for="pp-region">Region:</label>
          <select id="pp-region" class="pp-select" aria-label="Choose your region">
            <option value="scotland">Scotland</option>
            <option value="ireland">Ireland</option>
            <option value="england">England</option>
            <option value="wales">Wales</option>
          </select>
          <input id="pp-search" class="pp-search" type="search" placeholder="Search crops (e.g., carrot, basil)…" aria-label="Search crops by name">
          <label for="pp-category" class="sr-only">Category</label>
          <select id="pp-category" class="pp-select" aria-label="Filter by category">
            <option value="all">All categories</option>
            <option value="leafy">Leafy</option>
            <option value="roots">Roots</option>
            <option value="legumes">Legumes</option>
            <option value="fruit">Fruiting veg</option>
            <option value="alliums">Alliums</option>
            <option value="herbs">Herbs</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="right">
          <label><input type="checkbox" id="pp-this-month"> <span>Show activity this month only</span></label>
        </div>
      </div>
      <p class="pp-help">Tip: pick a <strong>Region</strong>, type to <strong>search</strong>, choose a <strong>Category</strong>, or toggle <strong>This month only</strong> for a focused view.</p>
    </section>

    <section class="pp-pestwatch" id="pp-pestwatch" aria-labelledby="pestwatch-title">
      <h3 id="pestwatch-title">Pest Watch – <span id="pp-month-name"></span> (<span id="pp-region-name"></span>)</h3>
      <ul><li>Loading…</li></ul>
    </section>

    <section class="pp-card" aria-labelledby="today-title">
      <h2 id="today-title">What Can I Plant Today?</h2>
      <p class="pp-month-hint" id="pp-month-hint"></p>
      <ul id="pp-today-list" class="pp-list"></ul>
    </section>

    <section aria-labelledby="calendar-title">
      <h2 id="calendar-title">Seasonal Planting Calendar</h2>
      <div class="pp-calendar" id="pp-calendar" role="table" aria-label="Seasonal planting calendar"></div>
    </section>
  </main>

  <!-- Footer (small centred pot + centred text) -->
  <footer role="contentinfo">
    <div class="footer-inner">
      <img src="img/patchandpot-icon.png" alt="Patch &amp; Pot icon" class="footer-pot" onerror="this.style.display='none'">
      <p>© Patch &amp; Pot | Created by Grant Cameron Anthony</p>
    </div>
  </footer>

  <!-- Inline loader to guarantee the header appears -->
  <script>
    (function loadHeader(){
      const holder = document.querySelector('[data-include="partials/header.html"]');
      if(!holder) return;
      fetch('partials/header.html', {cache:'no-store'})
        .then(r => r.text())
        .then(html => {
          holder.outerHTML = html;

          // Wire up active link + hamburger
          const header = document.getElementById('siteHeader');
          const toggle = header.querySelector('.menu-toggle');
          const nav = header.querySelector('#primaryNav');

          // active link
          const path = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
          header.querySelectorAll('.nav a').forEach(a=>{
            if(a.getAttribute('href').toLowerCase() === path){ a.setAttribute('aria-current','page'); }
          });

          function setExpanded(on){
            if(on){ header.classList.add('menu-open'); toggle.classList.add('menu-open'); toggle.setAttribute('aria-expanded','true'); }
            else{ header.classList.remove('menu-open'); toggle.classList.remove('menu-open'); toggle.setAttribute('aria-expanded','false'); }
          }
          if(toggle){ toggle.addEventListener('click', ()=> setExpanded(!header.classList.contains('menu-open'))); }
          if(nav){ nav.addEventListener('click', e => { if(e.target.tagName==='A') setExpanded(false); }); }
        })
        .catch(err => console.error('Header load failed:', err));
    })();
  </script>

  <!-- Seasonal logic (unchanged except robust data paths) -->
  <script>
    const PP_MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const CUR_M = new Date().getMonth();
    let DATA = { scotland:null, ireland:null, england:null, wales:null };

    function inferCategory(n){
      n = (n||'').toLowerCase();
      if (/(lettuce|spinach|chard|rocket|kale|cabbage|salad|leaf)/.test(n)) return 'leafy';
      if (/(carrot|beet|beetroot|radish|turnip|parsnip|root)/.test(n)) return 'roots';
      if (/(pea|bean)/.test(n)) return 'legumes';
      if (/(tomato|pepper|chilli|aubergine|eggplant|courgette|zucchini|cucumber|strawber|blueber|raspber|runner)/.test(n)) return 'fruit';
      if (/(onion|garlic|leek|shallot|spring onion)/.test(n)) return 'alliums';
      if (/(parsley|coriander|cilantro|basil|mint|thyme|sage|chive)/.test(n)) return 'herbs';
      return 'other';
    }

    function setMonthHints(){
      const m = PP_MONTHS[CUR_M];
      document.getElementById('pp-month-hint').textContent = `Here’s what suits containers now in ${m}.`;
      document.getElementById('pp-month-name').textContent = m;
    }
    function regionTitle(k){ return k.charAt(0).toUpperCase()+k.slice(1); }

    function renderPestWatch(regionKey){
      const region = DATA[regionKey] || {};
      const entry = (region.pestwatch && region.pestwatch[String(CUR_M)]) ||
        { items:["No major alerts this month. Keep an eye on slugs after rain."] };
      document.getElementById('pp-region-name').textContent = regionTitle(regionKey);
      document.querySelector('#pp-pestwatch ul').innerHTML = (entry.items||[]).map(i=>`<li>${i}</li>`).join('') || '<li>No items.</li>';
    }

    function getFilters(){
      return {
        q: document.getElementById('pp-search').value.trim().toLowerCase(),
        cat: document.getElementById('pp-category').value,
        thisMonth: document.getElementById('pp-this-month').checked
      };
    }
    function applyFilters(list){
      const f = getFilters();
      return (list||[]).filter(c=>{
        const name = c.name || '';
        const cat = c.category || inferCategory(name);
        if (f.q && !name.toLowerCase().includes(f.q)) return false;
        if (f.cat !== 'all' && cat !== f.cat) return false;
        if (f.thisMonth){
          const s=(c.months.sow||[]).includes(CUR_M);
          const p=(c.months.plant||[]).includes(CUR_M);
          const h=(c.months.harvest||[]).includes(CUR_M);
          if (!(s||p||h)) return false;
        }
        return true;
      });
    }

    function renderToday(rk){
      const region = DATA[rk] || {};
      const list = document.getElementById('pp-today-list');
      const items = [];
      applyFilters(region.crops||[]).forEach(c=>{
        const s=(c.months.sow||[]).includes(CUR_M);
        const p=(c.months.plant||[]).includes(CUR_M);
        const h=(c.months.harvest||[]).includes(CUR_M);
        if(s||p||h) items.push(`<li><strong>${c.name}</strong> ${s?"🌱":""}${p?" 🪴":""}${h?" 🥕":""} <span class="pp-tags">(${c.category || inferCategory(c.name)})</span></li>`);
      });
      list.innerHTML = items.length ? items.join('') : `<li>No items match your filters for ${PP_MONTHS[CUR_M]}.</li>`;
    }

    function renderCalendar(rk){
      const region = DATA[rk] || {};
      const root = document.getElementById('pp-calendar');
      const head = `<div class="pp-row"><div class="pp-head">Crop</div>${PP_MONTHS.map(m=>`<div class="pp-head">${m}</div>`).join('')}</div>`;
      const rows = applyFilters(region.crops||[]).map(c=>{
        const cat = c.category || inferCategory(c.name);
        const cells = PP_MONTHS.map((_,i)=>{
          const s=(c.months.sow||[]).includes(i);
          const p=(c.months.plant||[]).includes(i);
          const h=(c.months.harvest||[]).includes(i);
          const marks = [s?"🌱":"",p?"🪴":"",h?"🥕":""].join(' ').trim();
          const lbl = [s?"Sow":"",p?"Plant":"",h?"Harvest":""].filter(Boolean).join(', ');
          return `<div class="pp-cell" aria-label="${c.name} ${PP_MONTHS[i]} ${lbl}">${marks}</div>`;
        }).join('');
        return `<div class="pp-row"><div class="pp-cell pp-crop">${c.name} <span class="pp-tags">(${cat})</span></div>${cells}</div>`;
      }).join('');
      root.innerHTML = head + rows;
    }

    function renderAll(){
      const r = document.getElementById('pp-region').value;
      localStorage.setItem('pp-region', r);
      document.title = `Seasonal Planting (${r[0].toUpperCase()+r.slice(1)}) • Patch & Pot`;
      setMonthHints(); renderPestWatch(r); renderToday(r); renderCalendar(r);
    }

    function init(){
      const sel = document.getElementById('pp-region');
      sel.value = localStorage.getItem('pp-region') || 'scotland';
      ['pp-search','pp-category','pp-this-month'].forEach(id=>{
        document.getElementById(id).addEventListener(id==='pp-search'?'input':'change', renderAll);
      });
      sel.addEventListener('change', renderAll);
      renderAll();
    }

    // Robust data paths (works at /sites/seasonal.html and deployed)
    function tryPaths(paths){
      const next = () => {
        const p = paths.shift(); if(!p) return Promise.reject();
        return fetch(p + (p.includes('?')?'':'?v=' + Date.now()), {cache:'no-store'})
          .then(r=> r.ok ? r.json() : Promise.reject()).catch(next);
      };
      return next();
    }
    const here = location.pathname.replace(/[^/]+$/, ''); // folder of this page
    const rel = `${here}data/`;      // e.g. /sites/data/
    const abs = `/sites/data/`;      // absolute

    Promise.all([
      tryPaths([`${rel}crops-scotland.json`, `${abs}crops-scotland.json`]).then(j=>DATA.scotland=j),
      tryPaths([`${rel}crops-ireland.json`,  `${abs}crops-ireland.json`]).then(j=>DATA.ireland=j),
      tryPaths([`${rel}crops-england.json`,  `${abs}crops-england.json`]).then(j=>DATA.england=j),
      tryPaths([`${rel}crops-wales.json`,    `${abs}crops-wales.json`]).then(j=>DATA.wales=j),
    ]).then(init).catch(()=> {
      document.getElementById('pp-today-list').innerHTML = '<li>Sorry, data failed to load.</li>';
      const pest = document.querySelector('#pp-pestwatch ul'); if (pest) pest.innerHTML = '<li>Loading failed.</li>';
    });
  </script>
</body>
</html>
